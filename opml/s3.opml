<?xml encoding="ISO-8859-1" version="1.0"?>
<!-- OPML generated by OPML Editor v0.75 on 7/23/14; 4:01:30 PM -->
<opml version="2.0">
	<head>
		<title>s3.js</title>
		<expansionState></expansionState>
		<vertScrollState>1</vertScrollState>
		<windowTop>300</windowTop>
		<windowLeft>700</windowLeft>
		<windowBottom>900</windowBottom>
		<windowRight>1500</windowRight>
		</head>
	<body text="s3.js">
		<outline created="Sat, 26 Apr 2014 23:23:38 GMT" isComment="true" pgfnum="40494" text="A set of routines that can be included in a node project to connect to S3. ">
			<outline created="Sat, 26 Apr 2014 23:26:43 GMT" pgfnum="40495" text="You must put this at the top of the code that includes this.">
				<outline text="var AWS = require (&quot;aws-sdk&quot;);"></outline>
				<outline text="var s3 = new AWS.S3 ();"></outline>
				</outline>
			<outline created="Sat, 26 Apr 2014 23:28:37 GMT" pgfnum="40497" text="How to include">
				<outline created="Sat, 26 Apr 2014 23:28:41 GMT" pgfnum="40498" text="&lt;%includeHttp (&quot;http://fargo.io/code/node/shared/s3.js&quot;)%&gt;"></outline>
				</outline>
			<outline isComment="true" text="4/26/14 by DW"></outline>
			</outline>
		<outline text=" "></outline>
		<outline text=""></outline>
		<outline created="Wed, 22 Jan 2014 02:52:53 GMT" pgfnum="36219" text="var s3defaultType = &quot;text/plain&quot;;"></outline>
		<outline created="Wed, 22 Jan 2014 02:52:53 GMT" pgfnum="36219" text="var s3defaultAcl = &quot;public-read&quot;;"></outline>
		<outline text=""></outline>
		<outline text="var s3stats = {">
			<outline text="ctReads: 0, ctBytesRead: 0, ctReadErrors: 0, "></outline>
			<outline text="ctWrites: 0, ctBytesWritten: 0, ctWriteErrors: 0"></outline>
			<outline text="};"></outline>
			</outline>
		<outline created="Sun, 27 Apr 2014 01:24:43 GMT" pgfnum="40507" text=""></outline>
		<outline created="Wed, 22 Jan 2014 23:00:12 GMT" pgfnum="36404" text="function s3SplitPath (path) { //split path like this: /tmp.scripting.com/testing/one.txt -- into bucketname and path.">
			<outline created="Wed, 22 Jan 2014 23:02:12 GMT" pgfnum="36406" text="var bucketname = &quot;&quot;;"></outline>
			<outline created="Mon, 20 Jan 2014 03:38:45 GMT" pgfnum="35942" text="if (path.length &gt; 0) {">
				<outline created="Mon, 20 Jan 2014 03:39:22 GMT" pgfnum="35945" text="if (path [0] == &quot;/&quot;) { //delete the slash">
					<outline created="Mon, 20 Jan 2014 03:40:20 GMT" pgfnum="35947" text="path = path.substr (1); "></outline>
					<outline created="Mon, 20 Jan 2014 03:39:30 GMT" pgfnum="35946" text="}"></outline>
					</outline>
				<outline text="var ix = path.indexOf (&quot;/&quot;);"></outline>
				<outline created="Mon, 20 Jan 2014 03:43:33 GMT" pgfnum="35948" text="bucketname = path.substr (0, ix);"></outline>
				<outline created="Mon, 20 Jan 2014 03:44:19 GMT" pgfnum="35949" text="path = path.substr (ix + 1);"></outline>
				<outline created="Mon, 20 Jan 2014 03:38:57 GMT" pgfnum="35943" text="}"></outline>
				</outline>
			<outline created="Wed, 22 Jan 2014 23:03:05 GMT" pgfnum="36407" text="return ({Bucket: bucketname, Key: path});"></outline>
			<outline created="Wed, 22 Jan 2014 23:01:40 GMT" pgfnum="36405" text="}"></outline>
			</outline>
		<outline created="Mon, 20 Jan 2014 00:33:52 GMT" pgfnum="35899" text="function s3NewObject (path, data, type, acl, callback, metadata) {">
			<outline created="Sun, 27 Apr 2014 13:29:59 GMT" isComment="true" pgfnum="40514" text="Changes">
				<outline text="7/23/14; 4:01:09 PM by DW">
					<outline text="New optional param, metadata."></outline>
					</outline>
				<outline text="5/30/14; 4:24:50 PM by DW">
					<outline text="Added stats code."></outline>
					</outline>
				<outline created="Fri, 02 May 2014 22:19:25 GMT" pgfnum="40900" text="5/2/14; 6:19:26 PM by DW">
					<outline created="Fri, 02 May 2014 22:19:26 GMT" pgfnum="40901" text="I undid that change. The caller needs to be called in case of error, so it can return the error to its caller."></outline>
					</outline>
				<outline created="Sun, 27 Apr 2014 13:30:00 GMT" pgfnum="40515" text="4/27/14; 9:30:02 AM by DW">
					<outline created="Sun, 27 Apr 2014 13:30:05 GMT" pgfnum="40516" text="Callback no longer takes an &lt;i&gt;error&lt;/i&gt; param. We catch and report errors at this level. If we deploy this in Fargo Publisher this will break some of the callers, who are looking for an &lt;i&gt;error&lt;/i&gt; param. "></outline>
					</outline>
				</outline>
			<outline created="Thu, 23 Jan 2014 17:53:43 GMT" pgfnum="36441" text="var splitpath = s3SplitPath (path);"></outline>
			<outline created="Mon, 20 Jan 2014 00:36:10 GMT" pgfnum="35904" text="if (type == undefined) {">
				<outline created="Mon, 20 Jan 2014 00:36:16 GMT" pgfnum="35906" text="type = s3defaultType;"></outline>
				<outline created="Mon, 20 Jan 2014 00:36:19 GMT" pgfnum="35907" text="}"></outline>
				</outline>
			<outline created="Mon, 20 Jan 2014 00:36:10 GMT" pgfnum="35904" text="if (acl == undefined) {">
				<outline created="Mon, 20 Jan 2014 00:36:16 GMT" pgfnum="35906" text="acl = s3defaultAcl;"></outline>
				<outline created="Mon, 20 Jan 2014 00:36:19 GMT" pgfnum="35907" text="}"></outline>
				</outline>
			<outline created="Sun, 19 Jan 2014 02:48:19 GMT" pgfnum="35882" text="var params = {">
				<outline created="Sun, 19 Jan 2014 03:05:16 GMT" pgfnum="35889" text="ACL: acl,"></outline>
				<outline created="Sun, 19 Jan 2014 03:06:24 GMT" pgfnum="35890" text="ContentType: type,"></outline>
				<outline created="Sun, 19 Jan 2014 02:48:36 GMT" pgfnum="35884" text="Body: data,"></outline>
				<outline created="Sun, 19 Jan 2014 02:48:54 GMT" pgfnum="35885" text="Bucket: splitpath.Bucket,"></outline>
				<outline created="Sun, 19 Jan 2014 02:49:35 GMT" pgfnum="35886" text="Key: splitpath.Key,"></outline>
				<outline text="Metadata: metadata"></outline>
				<outline created="Sun, 19 Jan 2014 02:48:31 GMT" pgfnum="35883" text="};"></outline>
				</outline>
			<outline created="Sun, 19 Jan 2014 02:47:00 GMT" pgfnum="35877" text="s3.putObject (params, function (err, data) { ">
				<outline created="Sat, 22 Mar 2014 16:52:02 GMT" pgfnum="39739" text="if (err) {">
					<outline created="Sat, 22 Mar 2014 16:52:18 GMT" pgfnum="39743" text="console.log (&quot;s3NewObject: error == &quot; + err.message);"></outline>
					<outline text="s3stats.ctWriteErrors++;"></outline>
					<outline created="Wed, 22 Jan 2014 23:26:51 GMT" pgfnum="36419" text="if (callback != undefined) {">
						<outline created="Wed, 22 Jan 2014 23:26:10 GMT" pgfnum="36417" text="callback (err, data);"></outline>
						<outline created="Wed, 22 Jan 2014 23:27:05 GMT" pgfnum="36421" text="}"></outline>
						</outline>
					<outline created="Sat, 22 Mar 2014 16:52:05 GMT" pgfnum="39740" text="}"></outline>
					</outline>
				<outline created="Sun, 27 Apr 2014 13:27:21 GMT" pgfnum="40512" text="else {">
					<outline text="s3stats.ctWrites++;"></outline>
					<outline text="s3stats.ctBytesWritten += params.Body.length;"></outline>
					<outline created="Wed, 22 Jan 2014 23:26:51 GMT" pgfnum="36419" text="if (callback != undefined) {">
						<outline created="Wed, 22 Jan 2014 23:26:10 GMT" pgfnum="36417" text="callback (err, data);"></outline>
						<outline created="Wed, 22 Jan 2014 23:27:05 GMT" pgfnum="36421" text="}"></outline>
						</outline>
					<outline created="Sun, 27 Apr 2014 13:27:24 GMT" pgfnum="40513" text="}"></outline>
					</outline>
				<outline created="Sun, 19 Jan 2014 02:47:49 GMT" pgfnum="35878" text="});"></outline>
				</outline>
			<outline created="Mon, 20 Jan 2014 00:34:31 GMT" pgfnum="35902" text="}"></outline>
			</outline>
		<outline created="Thu, 30 Jan 2014 22:41:53 GMT" pgfnum="36606" text="function s3Redirect (path, url) { //1/30/14 by DW -- doesn't appear to work -- don't know why">
			<outline created="Thu, 23 Jan 2014 17:53:43 GMT" pgfnum="36441" text="var splitpath = s3SplitPath (path);"></outline>
			<outline created="Sun, 19 Jan 2014 02:48:19 GMT" pgfnum="35882" text="var params = {">
				<outline created="Thu, 30 Jan 2014 22:44:28 GMT" pgfnum="36611" text="WebsiteRedirectLocation: url,"></outline>
				<outline created="Sun, 19 Jan 2014 02:48:54 GMT" pgfnum="35885" text="Bucket: splitpath.Bucket,"></outline>
				<outline created="Sun, 19 Jan 2014 02:49:35 GMT" pgfnum="35886" text="Key: splitpath.Key,"></outline>
				<outline created="Thu, 30 Jan 2014 23:09:25 GMT" pgfnum="36626" text="Body: &quot; &quot;"></outline>
				<outline created="Sun, 19 Jan 2014 02:48:31 GMT" pgfnum="35883" text="};"></outline>
				</outline>
			<outline created="Sun, 19 Jan 2014 02:47:00 GMT" pgfnum="35877" text="s3.putObject (params, function (err, data) { ">
				<outline created="Sat, 01 Feb 2014 01:40:30 GMT" pgfnum="36696" text="if (err != null) {">
					<outline created="Thu, 30 Jan 2014 23:01:55 GMT" pgfnum="36623" text="consoleLog (&quot;s3Redirect: err.message = &quot; + err.message + &quot;.&quot;);"></outline>
					<outline created="Sat, 01 Feb 2014 01:40:38 GMT" pgfnum="36697" text="}"></outline>
					</outline>
				<outline created="Sun, 02 Feb 2014 02:51:04 GMT" pgfnum="36711" text="else {">
					<outline created="Thu, 30 Jan 2014 23:01:55 GMT" pgfnum="36623" text="consoleLog (&quot;s3Redirect: path = &quot; + path + &quot;, url = &quot; + url + &quot;, data = &quot;, JSON.stringify (data));"></outline>
					<outline created="Sun, 02 Feb 2014 02:51:10 GMT" pgfnum="36712" text="}"></outline>
					</outline>
				<outline created="Thu, 30 Jan 2014 23:01:48 GMT" pgfnum="36622" text="});"></outline>
				</outline>
			<outline created="Thu, 30 Jan 2014 22:42:05 GMT" pgfnum="36610" text="}"></outline>
			</outline>
		<outline created="Wed, 22 Jan 2014 22:59:13 GMT" pgfnum="36400" text="function s3GetObjectMetadata (path, callback) {">
			<outline created="Wed, 22 Jan 2014 23:04:04 GMT" pgfnum="36408" text="var params = s3SplitPath (path);"></outline>
			<outline created="Wed, 22 Jan 2014 23:05:46 GMT" pgfnum="36409" text="s3.headObject (params, function (err, data) {">
				<outline created="Wed, 22 Jan 2014 23:06:23 GMT" pgfnum="36411" text="callback (data);"></outline>
				<outline created="Wed, 22 Jan 2014 23:06:17 GMT" pgfnum="36410" text="});"></outline>
				</outline>
			<outline created="Wed, 22 Jan 2014 22:59:26 GMT" pgfnum="36401" text="}"></outline>
			</outline>
		<outline created="Wed, 22 Jan 2014 22:59:13 GMT" pgfnum="36400" text="function s3GetObject (path, callback) {">
			<outline isComment="true" text="Changes">
				<outline text="5/30/14; 4:27:32 PM by DW">
					<outline text="Stats."></outline>
					</outline>
				</outline>
			<outline created="Wed, 22 Jan 2014 23:04:04 GMT" pgfnum="36408" text="var params = s3SplitPath (path);"></outline>
			<outline created="Wed, 22 Jan 2014 23:05:46 GMT" pgfnum="36409" text="s3.getObject (params, function (err, data) {">
				<outline text="if (err) {">
					<outline text="s3stats.ctReadErrors++;"></outline>
					<outline text="}"></outline>
					</outline>
				<outline text="else {">
					<outline text="s3stats.ctReads++;"></outline>
					<outline text="s3stats.ctBytesRead += data.Body.length;"></outline>
					<outline text="}"></outline>
					</outline>
				<outline created="Wed, 22 Jan 2014 23:06:23 GMT" pgfnum="36411" text="callback (err, data);"></outline>
				<outline created="Wed, 22 Jan 2014 23:06:17 GMT" pgfnum="36410" text="});"></outline>
				</outline>
			<outline created="Wed, 22 Jan 2014 22:59:26 GMT" pgfnum="36401" text="}"></outline>
			</outline>
		<outline created="Wed, 19 Mar 2014 19:53:56 GMT" pgfnum="39564" text="function s3ListObjects (path, callback) {">
			<outline created="Sat, 22 Mar 2014 16:31:07 GMT" isComment="true" pgfnum="39712" text="Changes">
				<outline text="5/22/14; 1:07:10 PM by DW">
					<outline text="We add another field to the object passed to the callback -- s3path, the full path to the object being called-back-about. Otherwise the caller has no way to find it! Ouch."></outline>
					</outline>
				<outline created="Sat, 22 Mar 2014 16:31:10 GMT" pgfnum="39713" text="3/22/14; 12:31:11 PM by DW">
					<outline created="Sat, 22 Mar 2014 16:31:11 GMT" pgfnum="39714" text="We call the callback once for every object and one last time, so you can send back the result to a client if that's what you're doing."></outline>
					<outline created="Sat, 22 Mar 2014 16:31:49 GMT" pgfnum="39715" text="On the last call, the object has one field -- flLastObject, value true. "></outline>
					</outline>
				</outline>
			<outline created="Thu, 23 Jan 2014 17:53:43 GMT" pgfnum="36441" text="var splitpath = s3SplitPath (path);"></outline>
			<outline created="Thu, 20 Mar 2014 17:09:28 GMT" pgfnum="39669" text="function getNextGroup (marker) {">
				<outline created="Thu, 20 Mar 2014 17:10:17 GMT" pgfnum="39676" text="var params = {Bucket: splitpath.Bucket, Prefix: splitpath.Key};"></outline>
				<outline created="Thu, 20 Mar 2014 17:09:54 GMT" pgfnum="39673" text="if (marker != undefined) {">
					<outline created="Thu, 20 Mar 2014 17:10:53 GMT" pgfnum="39677" text="params = {Bucket: splitpath.Bucket, Prefix: splitpath.Key, Marker: marker};"></outline>
					<outline created="Thu, 20 Mar 2014 17:10:14 GMT" pgfnum="39675" text="}"></outline>
					</outline>
				<outline created="Wed, 22 Jan 2014 23:05:46 GMT" pgfnum="36409" text="s3.listObjects (params, function (err, data) {">
					<outline created="Sat, 22 Mar 2014 16:52:02 GMT" pgfnum="39739" text="if (err) {">
						<outline created="Sat, 22 Mar 2014 16:52:18 GMT" pgfnum="39743" text="console.log (&quot;s3ListObjects: error == &quot; + err.message);"></outline>
						<outline created="Sat, 22 Mar 2014 16:52:05 GMT" pgfnum="39740" text="}"></outline>
						</outline>
					<outline created="Sat, 22 Mar 2014 16:52:06 GMT" pgfnum="39741" text="else {">
						<outline created="Thu, 20 Mar 2014 17:13:53 GMT" pgfnum="39686" text="var lastobj = data.Contents [data.Contents.length - 1];"></outline>
						<outline created="Wed, 19 Mar 2014 22:00:43 GMT" pgfnum="39580" text="for (var i = 0; i &lt; data.Contents.length; i++) {">
							<outline text="data.Contents [i].s3path = splitpath.Bucket + &quot;/&quot; + data.Contents [i].Key; //5/22/14 by DW"></outline>
							<outline created="Wed, 19 Mar 2014 22:01:14 GMT" pgfnum="39585" text="callback (data.Contents [i]);"></outline>
							<outline created="Wed, 19 Mar 2014 22:01:04 GMT" pgfnum="39583" text="}"></outline>
							</outline>
						<outline created="Thu, 20 Mar 2014 17:11:52 GMT" pgfnum="39678" text="if (data.IsTruncated) {">
							<outline created="Thu, 20 Mar 2014 17:12:28 GMT" pgfnum="39682" text="getNextGroup (lastobj.Key);"></outline>
							<outline created="Thu, 20 Mar 2014 17:11:55 GMT" pgfnum="39681" text="}"></outline>
							</outline>
						<outline created="Sat, 22 Mar 2014 16:39:43 GMT" pgfnum="39722" text="else {">
							<outline created="Sat, 22 Mar 2014 16:39:48 GMT" pgfnum="39724" text="var obj = new Object ();"></outline>
							<outline created="Sat, 22 Mar 2014 16:39:54 GMT" pgfnum="39725" text="obj.flLastObject = true;"></outline>
							<outline created="Sat, 22 Mar 2014 16:39:59 GMT" pgfnum="39726" text="callback (obj);"></outline>
							<outline created="Sat, 22 Mar 2014 16:39:45 GMT" pgfnum="39723" text="}"></outline>
							</outline>
						<outline created="Sat, 22 Mar 2014 16:52:15 GMT" pgfnum="39742" text="}"></outline>
						</outline>
					<outline created="Wed, 22 Jan 2014 23:06:17 GMT" pgfnum="36410" text="});"></outline>
					</outline>
				<outline created="Thu, 20 Mar 2014 17:09:42 GMT" pgfnum="39672" text="}"></outline>
				</outline>
			<outline created="Thu, 20 Mar 2014 17:14:59 GMT" pgfnum="39687" text="getNextGroup ();"></outline>
			<outline created="Wed, 19 Mar 2014 19:54:10 GMT" pgfnum="39566" text="}"></outline>
			</outline>
		<outline text=""></outline>
		<outline text=""></outline>
		<outline text=""></outline>
		<outline text=""></outline>
		</body>
	</opml>
